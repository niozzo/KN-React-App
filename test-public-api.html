<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KN React App - Public API Test</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: 500;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .table-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .table-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
        }
        .table-name {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
        }
        .row-count {
            font-size: 24px;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 5px;
        }
        .table-status {
            font-size: 14px;
            color: #6c757d;
        }
        .summary {
            background: #e9ecef;
            border-radius: 5px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }
        .summary h2 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .total-rows {
            font-size: 32px;
            font-weight: 700;
            color: #007bff;
        }
        .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px 0;
        }
        .refresh-btn:hover {
            background: #0056b3;
        }
        .error-details {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèóÔ∏è Knowledge Now React App - Public API Test</h1>
        
        <div id="connection-status" class="status loading">
            üîÑ Connecting to database...
        </div>
        
        <button class="refresh-btn" onclick="testConnection()">üîÑ Refresh Test</button>
        
        <div class="table-grid" id="table-results">
            <!-- Results will be populated here -->
        </div>
        
        <div class="summary" id="summary">
            <!-- Summary will be populated here -->
        </div>
    </div>

    <script>
        // Supabase configuration
        const supabaseUrl = 'https://iikcgdhztkrexuuqheli.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlpa2NnZGh6dGtyZXh1dXFoZWxpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMzY3NDEsImV4cCI6MjA3MjYxMjc0MX0.N3KNNn6N_S4qPlBeclj07QsekCeZnF_FkBKef96XnO8'
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        // Tables to test
        const tables = [
            { name: 'attendees', expected: 222, description: 'Attendee profiles and preferences' },
            { name: 'sponsors', expected: 27, description: 'Sponsor directory with logos' },
            { name: 'seat_assignments', expected: 29, description: 'Seating assignments' },
            { name: 'agenda_items', expected: 0, description: 'Event sessions and agenda' },
            { name: 'dining_options', expected: 0, description: 'Dining events' },
            { name: 'hotels', expected: 0, description: 'Hotel directory' },
            { name: 'seating_configurations', expected: 0, description: 'Seating layouts' },
            { name: 'layout_templates', expected: 0, description: 'Layout templates' },
            { name: 'breakout_sessions', expected: 0, description: 'Breakout sessions' },
            { name: 'import_history', expected: 0, description: 'Import tracking' },
            { name: 'user_profiles', expected: 0, description: 'User accounts' }
        ]
        
        async function testConnection() {
            const statusEl = document.getElementById('connection-status')
            const resultsEl = document.getElementById('table-results')
            const summaryEl = document.getElementById('summary')
            
            statusEl.className = 'status loading'
            statusEl.textContent = 'üîÑ Testing database connection...'
            
            resultsEl.innerHTML = ''
            summaryEl.innerHTML = ''
            
            let totalRows = 0
            let successCount = 0
            let errorCount = 0
            const errors = []
            
            for (const table of tables) {
                try {
                    const { count, error } = await supabase
                        .from(table.name)
                        .select('*', { count: 'exact', head: true })
                    
                    if (error) {
                        throw error
                    }
                    
                    const rowCount = count || 0
                    totalRows += rowCount
                    successCount++
                    
                    const status = rowCount === table.expected ? '‚úÖ' : 
                                  table.expected === 0 ? 'üìù' : '‚ö†Ô∏è'
                    
                    const statusText = rowCount === table.expected ? 'Expected' :
                                      table.expected === 0 ? 'Empty (OK)' : 'Unexpected'
                    
                    resultsEl.innerHTML += `
                        <div class="table-card">
                            <div class="table-name">${status} ${table.name}</div>
                            <div class="row-count">${rowCount.toLocaleString()}</div>
                            <div class="table-status">${statusText} ‚Ä¢ ${table.description}</div>
                        </div>
                    `
                } catch (error) {
                    errorCount++
                    errors.push({ table: table.name, error: error.message })
                    
                    resultsEl.innerHTML += `
                        <div class="table-card">
                            <div class="table-name">‚ùå ${table.name}</div>
                            <div class="row-count">Error</div>
                            <div class="table-status">Failed to access ‚Ä¢ ${table.description}</div>
                            <div class="error-details">${error.message}</div>
                        </div>
                    `
                }
            }
            
            // Update status
            if (errorCount === 0) {
                statusEl.className = 'status success'
                statusEl.textContent = `‚úÖ All tables accessible! ${successCount} tables tested successfully.`
            } else if (successCount > 0) {
                statusEl.className = 'status error'
                statusEl.textContent = `‚ö†Ô∏è Partial access: ${successCount} tables OK, ${errorCount} tables failed.`
            } else {
                statusEl.className = 'status error'
                statusEl.textContent = `‚ùå No tables accessible. RLS policies may need to be configured.`
            }
            
            // Update summary
            summaryEl.innerHTML = `
                <h2>üìä Database Summary</h2>
                <div class="total-rows">${totalRows.toLocaleString()} total rows</div>
                <p>${successCount} tables accessible ‚Ä¢ ${errorCount} tables with errors</p>
            `
            
            // Show errors if any
            if (errors.length > 0) {
                summaryEl.innerHTML += `
                    <div style="margin-top: 20px; text-align: left;">
                        <h3>‚ùå Errors:</h3>
                        ${errors.map(e => `<div><strong>${e.table}:</strong> ${e.error}</div>`).join('')}
                    </div>
                `
            }
        }
        
        // Run test on page load
        window.addEventListener('load', testConnection)
    </script>
</body>
</html>

