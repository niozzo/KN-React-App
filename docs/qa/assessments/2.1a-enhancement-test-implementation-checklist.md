# Test Implementation Checklist - Story 2.1a Enhancement

**Priority:** P0 (High) - Critical test coverage gaps identified  
**Estimated Effort:** 4-6 hours  
**Target Completion:** Before next deployment

## üö® Critical Test Coverage Gaps

### Current Status
- ‚úÖ **Admin Service Core Logic:** 100% covered (8/8 tests passing)
- ‚úÖ **Passcode Screen:** 100% covered (1/1 test passing)  
- ‚ùå **Application Database Enhancement:** 0% covered (0/24 tests implemented)
- ‚ö†Ô∏è **PWA Sync Service Enhancement:** 78% covered (11/14 tests passing)

## üìã Implementation Checklist

### Phase 1: Unit Tests (P0 - Must Fix)
**Estimated Time:** 2-3 hours

#### PWA Data Sync Service Tests
- [ ] **2.1a-UNIT-001:** `syncApplicationTable` method syncs speaker_assignments
- [ ] **2.1a-UNIT-002:** `syncApplicationTable` method syncs agenda_item_metadata  
- [ ] **2.1a-UNIT-003:** `syncApplicationTable` method syncs attendee_metadata
- [ ] **2.1a-UNIT-004:** `syncApplicationTable` handles database errors gracefully
- [ ] **2.1a-UNIT-007:** `cacheTableData` method is public for admin service

#### Data Clearing Service Tests  
- [ ] **2.1a-UNIT-009:** `clearLocalStorageData` includes application database keys
- [ ] **2.1a-UNIT-010:** `verifyDataCleared` checks application database data

### Phase 2: Integration Tests (P0 - Must Fix)
**Estimated Time:** 2-3 hours

#### Admin Service + PWA Sync Integration
- [ ] **2.1a-INT-001:** `getAgendaItemsWithAssignments` loads from local storage first
- [ ] **2.1a-INT-002:** `assignSpeakerToAgendaItem` updates local storage
- [ ] **2.1a-INT-003:** `removeSpeakerFromAgendaItem` updates local storage
- [ ] **2.1a-INT-006:** Admin operations fallback to database when local storage fails

### Phase 3: End-to-End Tests (P0 - Must Fix)
**Estimated Time:** 1-2 hours

#### Complete User Workflows
- [ ] **2.1a-E2E-001:** Admin can assign speakers with data persisting locally and in DB
- [ ] **2.1a-E2E-004:** Logout clears all application database data

### Phase 4: Additional Tests (P1 - Should Fix)
**Estimated Time:** 1-2 hours

#### Secondary Functionality
- [ ] **2.1a-UNIT-005:** `syncAllData` includes application tables in sync process
- [ ] **2.1a-UNIT-006:** `getOfflineDataStatus` includes application tables
- [ ] **2.1a-INT-004:** `updateLocalSpeakerAssignments` merges data correctly
- [ ] **2.1a-INT-005:** `removeLocalSpeakerAssignment` filters data correctly
- [ ] **2.1a-E2E-002:** Admin operations work offline with local storage
- [ ] **2.1a-E2E-003:** Background sync updates local storage with DB changes

## üõ†Ô∏è Implementation Guide

### File Structure
```
src/__tests__/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ pwaDataSyncService.enhancement.test.ts    # New unit tests
‚îÇ   ‚îú‚îÄ‚îÄ adminService.integration.test.ts          # New integration tests
‚îÇ   ‚îî‚îÄ‚îÄ dataClearingService.enhancement.test.ts   # New unit tests
‚îî‚îÄ‚îÄ e2e/
    ‚îî‚îÄ‚îÄ admin-application-db.test.tsx             # New E2E tests
```

### Test Implementation Template

#### Unit Test Template
```typescript
// src/__tests__/services/pwaDataSyncService.enhancement.test.ts
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { pwaDataSyncService } from '../../services/pwaDataSyncService';

// Mock application database
vi.mock('../../services/applicationDatabaseService', () => ({
  applicationDb: {
    from: vi.fn(() => ({
      select: vi.fn().mockResolvedValue({
        data: [{ id: '1', name: 'Test' }],
        error: null
      })
    }))
  }
}));

describe('Application Database Sync Enhancement', () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('2.1a-UNIT-001: should sync speaker_assignments table', async () => {
    // Implementation here
  });
});
```

#### Integration Test Template
```typescript
// src/__tests__/services/adminService.integration.test.ts
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { adminService } from '../../services/adminService';
import { pwaDataSyncService } from '../../services/pwaDataSyncService';

// Mock PWA sync service
vi.mock('../../services/pwaDataSyncService', () => ({
  pwaDataSyncService: {
    getCachedTableData: vi.fn(),
    cacheTableData: vi.fn()
  }
}));

describe('Admin Service + PWA Sync Integration', () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('2.1a-INT-001: should load speaker assignments from local storage first', async () => {
    // Implementation here
  });
});
```

### Mock Strategy
- **Application Database:** Mock `applicationDb` for all database operations
- **PWA Sync Service:** Mock `pwaDataSyncService` for admin service tests
- **Local Storage:** Mock `localStorage` for storage operations
- **E2E Tests:** Use real components with mocked external dependencies

## ‚úÖ Success Criteria

### Must Pass (P0)
- [ ] All 10 P0 unit tests implemented and passing
- [ ] All 4 P0 integration tests implemented and passing  
- [ ] All 2 P0 E2E tests implemented and passing
- [ ] Code coverage ‚â•85% for new application database functionality

### Should Pass (P1)
- [ ] All 6 P1 tests implemented and passing
- [ ] Performance tests complete within timeout limits
- [ ] No critical bugs in application database functionality

## üöÄ Quick Start

1. **Start with Unit Tests** - They're fastest to implement and provide immediate feedback
2. **Focus on P0 Tests First** - These cover the most critical functionality
3. **Use Existing Test Patterns** - Follow the patterns in existing test files
4. **Test One Component at a Time** - Don't try to implement all tests at once

## üìû Support

- **Test Design Document:** `docs/qa/assessments/2.1a-enhancement-test-design-20250116.md`
- **Existing Test Examples:** `src/__tests__/adminService.test.ts`, `src/__tests__/services/pwaDataSyncService.test.ts`
- **QA Contact:** Quinn (Test Architect) - Available for questions and review

## ‚ö†Ô∏è Critical Notes

- **Security Risk:** Missing logout cleanup tests could lead to data leakage
- **Data Consistency Risk:** Missing integration tests could lead to data inconsistency
- **Performance Risk:** Missing sync tests could lead to poor user experience
- **Deployment Risk:** Deploying without these tests increases bug risk significantly

**Recommendation:** Complete P0 tests before next deployment to ensure quality and security.
