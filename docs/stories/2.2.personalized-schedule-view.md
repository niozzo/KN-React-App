# Story 2.2: Personalized Schedule View

## Status
Draft

## Story
**As an** attendee,  
**I want** to view my combined schedule (general + breakouts + dinner + seat assignments),  
**so that** I have a complete view of my conference experience.

## Acceptance Criteria
1. Combines general agenda with identity-linked assignments from Supabase
2. Indicates assigned seat/table; supports dynamic timing updates from admin
3. **Simple agenda view** - No filtering controls; clean, straightforward schedule display
4. **Card-based layout** - Sessions grouped under day headers as cohesive visual units
5. **Consistent content positioning** - Status (left) and time (right) in header; title, location, speaker details below
6. **Day header design** - Purple headers that attach to session cards below (rounded top, flat bottom)
7. **Seat visibility** - White background for seat info in current session cards for better contrast
8. **Progressive disclosure** for seat maps and details
9. **TDD**: All schedule view components have comprehensive unit tests (80% line coverage)
10. **TDD**: Integration tests for data fetching, filtering, and user interactions (70% branch coverage)
11. **TDD**: PWA offline functionality testing for cached schedule data
12. **TDD**: Real-time update testing for dynamic timing and seat assignments

## Tasks / Subtasks
- [ ] Task 1: Create schedule data integration (AC: 1)
  - [ ] Implement data fetching from Supabase
  - [ ] Combine general agenda with user assignments
  - [ ] **Include dining options from 2.1g.1 integration**
  - [ ] Handle data synchronization
  - [ ] Add error handling for data failures
- [ ] Task 2: Implement seat assignment display (AC: 2)
  - [ ] Add seat/table indicators to schedule items
  - [ ] Implement dynamic timing updates
  - [ ] Add admin update integration
  - [ ] Handle missing seat assignments
- [ ] Task 3: Implement card-based layout (AC: 4, 5, 6)
  - [ ] Create day header components with purple styling
  - [ ] Group sessions under day headers as cohesive cards
  - [ ] Implement sticky header behavior
  - [ ] Add proper card styling and shadows
- [ ] Task 4: Ensure consistent content positioning (AC: 5)
  - [ ] Implement header layout with status left, time right
  - [ ] Position title, location, speaker details consistently
  - [ ] Add seat information at bottom of relevant sessions
  - [ ] Ensure responsive behavior maintains layout
- [ ] Task 5: Implement seat visibility improvements (AC: 7)
  - [ ] Add white background for seat info in current sessions
  - [ ] Implement proper contrast for seat assignments
  - [ ] Add border styling for seat information boxes
- [ ] Task 6: Add progressive disclosure (AC: 8)
  - [ ] Implement expandable session details
  - [ ] Add seat map integration
  - [ ] Create detail modal/page
  - [ ] Add navigation between details
- [ ] Task 7: Implement TDD for schedule view system (AC: 9-12)
  - [ ] Write unit tests for schedule components and data integration (80% line coverage)
  - [ ] Write integration tests for data fetching, filtering, and user interactions (70% branch coverage)
  - [ ] Write PWA offline tests for cached schedule data and revalidation
  - [ ] Write real-time update tests for dynamic timing and seat assignments
  - [ ] Validate test coverage meets all thresholds
  - [ ] Update test documentation with Given-When-Then patterns

## Dev Notes
### Project Context
The personalized schedule view provides attendees with a comprehensive view of their conference experience, combining general agenda items with their specific assignments and seat information.

### Technical Requirements
- **Data Source**: Supabase with real-time updates
- **Performance**: Fast loading and smooth scrolling
- **Responsive**: Mobile-optimized interface
- **Accessibility**: Screen reader support

### Key Features
- Combined general and personal agenda
- Seat assignment indicators
- **Simple agenda view** without filtering complexity
- **Card-based layout** with day headers
- **Consistent content positioning** matching home page
- Sticky navigation headers
- Progressive detail disclosure

### UX Design Requirements
- **Layout Consistency**: Status badge (left) and time (right) in same line header
- **Time Positioning**: Always in top-right corner of each session card
- **Card Grouping**: Sessions grouped under day headers as single visual units
- **Day Header Design**: Purple headers with rounded top, flat bottom corners
- **Seat Visibility**: White background for seat info in current session cards
- **No Left Borders**: Clean card design without heavy purple edge borders
- **Responsive Behavior**: Maintains layout integrity across screen sizes
- **Content Hierarchy**: Title, location, speaker info in consistent positions

### Dependencies
- **Story 2.1g.1 (Dining Options Data Integration)** - Provides dining data integration
- **Story 2.1g.2 (Home Page Now/Next Dining Integration)** - Provides dining card display
- **Story 2.1g.3 (SessionCard Dining Support)** - Provides dining card component support
- Existing `useSessionData` hook
- Existing caching infrastructure

### Testing Standards
- **Test Framework**: Vitest + React Testing Library (TDD infrastructure established)
- **Test Location**: `src/__tests__/components/schedule/`
- **Coverage**: 80% line, 85% function, 70% branch coverage
- **PWA Testing**: Offline data availability and revalidation
- **Real-time Testing**: Dynamic timing updates and seat assignment changes
- **Integration Testing**: Data fetching and user interaction flows
- **Test Pattern**: Given-When-Then for all schedule view scenarios

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | Initial story creation | Sarah (PO) |
| 2025-01-16 | 1.1 | Added dining integration dependencies and task updates | Sarah (PO) |
| 2024-12-19 | 1.1 | Updated with card-based layout, consistent positioning, and UX design requirements | Sarah (PO) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results

### **Quality Gate: PASS** ✅
**Review Date:** 2025-01-16  
**Reviewer:** Quinn (Test Architect)

#### **Requirements Traceability: EXCELLENT**
- ✅ All acceptance criteria map to specific test scenarios
- ✅ Dining integration dependencies properly identified
- ✅ Card reuse strategy clearly defined

#### **Risk Assessment: LOW-MEDIUM**
- **Dining Integration Risk**: LOW - Inherits from 2.1g stories
- **Card Reuse Risk**: LOW - Well-established pattern
- **Performance Risk**: MEDIUM - Additional data in schedule view
- **Layout Risk**: LOW - Existing card-based design

#### **Test Strategy Enhancements**

**1. Enhanced Integration Testing (AC: 1)**
```typescript
// Given-When-Then Integration Test Scenarios
describe('Schedule View Dining Integration', () => {
  describe('Given dining options are available', () => {
    it('When schedule loads, Then dining events appear in day groups', () => {
      // Test dining integration in schedule view
    });
    
    it('When dining event is current, Then it displays with proper styling', () => {
      // Test dining event display
    });
  });
  
  describe('Given mixed sessions and dining events', () => {
    it('When sorted by time, Then events are properly ordered', () => {
      // Test unified sorting
    });
  });
});
```

**2. Card Reuse Validation**
- Dining cards inherit all SessionCard functionality
- Consistent behavior across home and schedule pages
- Proper variant support (now/next/agenda)
- Animation consistency maintained

**3. Performance Testing**
- Schedule view with 100+ dining options
- Card rendering performance with mixed content
- Memory usage during schedule navigation
- Cache efficiency with dining data

**4. Layout Consistency Testing**
- Day headers work with dining events
- Card grouping includes dining events
- Sticky header behavior with dining content
- Responsive design across all screen sizes

#### **Non-Functional Requirements Validation**
- **Performance**: <300ms schedule view load time
- **Consistency**: Identical card behavior across pages
- **Scalability**: Support 500+ total events (sessions + dining)
- **Maintainability**: Clean separation of concerns

#### **Test Coverage Targets**
- **Line Coverage**: 85% (increased from 80%)
- **Branch Coverage**: 75% (increased from 70%)
- **Function Coverage**: 90% (increased from 85%)

#### **Critical Test Cases**
1. **Dining Integration**: Dining events appear in schedule view
2. **Card Reuse**: Dining cards work identically to session cards
3. **Performance**: Schedule view performance with dining data
4. **Layout Consistency**: Day grouping works with mixed content
5. **Error Handling**: Dining data failures don't break schedule

#### **Dependencies Validation**
- **2.1g.1**: Data integration provides dining options
- **2.1g.2**: Home page integration validates card display
- **2.1g.3**: SessionCard support enables dining cards
- **Card Reuse**: Automatic inheritance of dining functionality

#### **Recommendations**
1. **Integration Testing**: Validate dining inheritance from 2.1g stories
2. **Performance Monitoring**: Track schedule view performance metrics
3. **Card Consistency**: Ensure identical behavior across pages
4. **Load Testing**: Validate performance with realistic data volumes
