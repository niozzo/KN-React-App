# Story 3.1: Attendee Search & Discovery

## Status
Draft

## Story
**As an** attendee,  
**I want** to search and filter other attendees by various criteria,  
**so that** I can find people I want to meet at the conference.

## Acceptance Criteria
1. Search/filter by name, company, role, title
2. Respect discoverability opt-out settings
3. Display attendee profiles with relevant information
4. Integration with sponsor attendee discovery
5. **NEW**: Progressive reveal search section with collapsible "Find People to Meet" interface
6. **NEW**: Simplified filter system with "Show only people with shared events" toggle
7. **NEW**: Enhanced sort dropdown with integrated labels (Last Name, First Name, Company Name)
8. **NEW**: Sticky tab navigation that remains accessible while scrolling
9. **NEW**: Attached expanded views for seamless UI transitions
10. **TDD**: All search and discovery components have comprehensive unit tests (80% line coverage)
11. **TDD**: Integration tests for search functionality, filtering, and user interactions (70% branch coverage)
12. **TDD**: PWA offline functionality testing for cached attendee data
13. **TDD**: Performance testing for large attendee lists and search optimization

## Tasks / Subtasks
- [ ] Task 1: Implement search functionality (AC: 1)
  - [ ] Create search interface with multiple filters
  - [ ] Implement name-based search
  - [ ] Add company and role filtering
  - [ ] Implement free text bio search
- [ ] Task 2: Add privacy controls (AC: 2)
  - [ ] Implement discoverability opt-out respect
  - [ ] Add privacy filtering
  - [ ] Handle consent management
  - [ ] Add privacy indicators
- [ ] Task 3: Create attendee profiles (AC: 3)
  - [ ] Design profile display components
  - [ ] Add relevant information display
  - [ ] Implement profile navigation
  - [ ] Add contact information display
- [ ] Task 4: Integrate with sponsor discovery (AC: 4)
  - [ ] Connect to sponsor attendee lists
  - [ ] Add sponsor context to profiles
  - [ ] Implement sponsor filtering
  - [ ] Add sponsor badge display
- [ ] **NEW Task 5: Implement progressive reveal interface (AC: 5)**
  - [ ] Create collapsible "Find People to Meet" section
  - [ ] Implement smooth expand/collapse animations
  - [ ] Add visual attachment for expanded state
  - [ ] Ensure responsive behavior
- [ ] **NEW Task 6: Implement simplified filtering (AC: 6)**
  - [ ] Create "Show only people with shared events" toggle
  - [ ] Implement toggle functionality
  - [ ] Add visual feedback for active state
  - [ ] Ensure performance with large lists
- [ ] **NEW Task 7: Implement enhanced sorting (AC: 7)**
  - [ ] Create dropdown sort interface
  - [ ] Integrate "Sort by" labels into options
  - [ ] Implement sort functionality (Last Name, First Name, Company Name)
  - [ ] Add visual feedback for sort state
- [ ] **NEW Task 8: Implement sticky navigation (AC: 8)**
  - [ ] Create sticky tab navigation
  - [ ] Ensure proper z-index and positioning
  - [ ] Add smooth transitions
  - [ ] Test across different screen sizes
- [ ] **NEW Task 9: Implement attached expanded views (AC: 9)**
  - [ ] Create seamless attachment for expanded sections
  - [ ] Implement visual continuity
  - [ ] Add smooth transitions
  - [ ] Ensure responsive behavior
- [ ] **Task 10: Implement TDD for attendee search system (AC: 10-13)**
  - [ ] Write unit tests for search components, filtering, and sorting (80% line coverage)
  - [ ] Write integration tests for search functionality and user interactions (70% branch coverage)
  - [ ] Write PWA offline tests for cached attendee data and search results
  - [ ] Write performance tests for large attendee lists and search optimization
  - [ ] Validate test coverage meets all thresholds
  - [ ] Update test documentation with Given-When-Then patterns

## Dev Notes
### Project Context
Attendee search and discovery enables networking at the conference by helping attendees find and connect with other participants based on various criteria.

### Technical Requirements
- **Search**: Fast, multi-criteria search
- **Privacy**: Respect user consent settings
- **Performance**: Optimized for large datasets
- **Integration**: Connected to sponsor system

### Mockup References
- **Primary Mockup**: `mockups/meet.html`
- **Search Section**: Lines 919-926 (Progressive reveal "Find People to Meet" section)
- **Filter Controls**: Lines 927-950 (Simplified filter toggle and sort dropdown)
- **Sticky Navigation**: Lines 160-210 (CSS classes for sticky positioning and transitions)
- **Attached Views**: CSS classes `.search-section-header.expanded` and `.search-section` for seamless attachment

### Testing Standards
- **Test Framework**: Vitest + React Testing Library (TDD infrastructure established)
- **Test Location**: `src/__tests__/components/search/`
- **Coverage**: 80% line, 85% function, 70% branch coverage
- **PWA Testing**: Offline attendee data availability and search functionality
- **Performance Testing**: Large attendee lists and search optimization
- **Integration Testing**: Search functionality and user interaction flows
- **Test Pattern**: Given-When-Then for all search and discovery scenarios

### Architectural Guidance

#### **Data Architecture**
- **Primary Data Source**: Leverage existing `AttendeeService` and `OfflineAttendeeService` patterns
- **Caching Strategy**: Extend current localStorage-first approach for search results
- **Privacy Controls**: Integrate with existing `discoverability` opt-out settings in attendee attributes
- **Performance**: Use existing `useSearch` hook pattern for client-side filtering
- **PWA Integration**: Extend `pwaDataSyncService` for search result caching

#### **Component Architecture**
- **Search Interface**: Create `AttendeeSearchSection` component following existing `ScheduleView` patterns
- **Progressive Reveal**: Implement collapsible interface using existing animation patterns from `AnimationWrapper`
- **Filter Components**: Extend current `useSearch` hook with new filter options
- **Sticky Navigation**: Use existing CSS patterns from service worker cache management
- **State Management**: Follow existing hook patterns (`useSessionData`, `useAttendeeData`)

#### **Service Layer Integration**
- **Search Service**: Extend `AttendeeService.searchAttendees()` with enhanced filtering
- **Offline Support**: Integrate with `OfflineAttendeeService.searchAttendees()` for PWA functionality
- **Sponsor Integration**: Connect with existing `SponsorService` for sponsor attendee discovery
- **Performance**: Implement search result pagination using existing `PaginatedResponse` patterns

#### **Performance Considerations**
- **Search Optimization**: Implement debounced search with 300ms delay
- **Result Caching**: Cache search results in localStorage for instant subsequent searches
- **Large Dataset Handling**: Use virtual scrolling for attendee lists > 100 items
- **Memory Management**: Implement search result cleanup after 5 minutes of inactivity

#### **Security & Privacy**
- **Data Filtering**: Respect existing RLS policies and attendee privacy settings
- **Access Control**: Ensure search respects authentication and authorization patterns
- **Data Exposure**: Limit searchable fields to public attendee information only
- **Audit Trail**: Log search activities for compliance (if required)

#### **Integration Points**
- **Authentication**: Use existing `AuthContext` for user identification
- **Navigation**: Integrate with existing `BottomNav` and routing patterns
- **Error Handling**: Follow existing error handling patterns from `monitoringService`
- **Offline Support**: Extend existing PWA architecture for offline search functionality

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | Initial story creation | Sarah (PO) |
| 2024-12-19 | 1.1 | Updated with mockup changes: progressive reveal, simplified filtering, enhanced sorting, sticky navigation | Sarah (PO) |
| 2024-12-19 | 1.2 | Fixed AC numbering consistency, updated task references, corrected mockup line references | Sarah (PO) |
| 2024-12-19 | 1.3 | Added comprehensive architectural guidance for data, component, service layer, performance, security, and integration considerations | Winston (Architect) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results

### **Test Strategy Assessment - Version 1.3**

**Review Date:** 2024-12-19  
**Reviewer:** Quinn (Test Architect)  
**Story Status:** Draft → Ready for Development  
**Quality Gate:** **PASS** with Enhanced Test Strategy Recommendations

---

### **📋 Requirements Traceability Analysis**

**✅ COMPLETE COVERAGE** - All 13 Acceptance Criteria have corresponding test requirements:

| AC | Requirement | Test Strategy | Coverage |
|---|---|---|---|
| 1 | Search/filter by name, company, role, title | Unit + Integration | ✅ |
| 2 | Respect discoverability opt-out settings | Security + Privacy | ✅ |
| 3 | Display attendee profiles | Component + UI | ✅ |
| 4 | Sponsor attendee discovery | Integration | ✅ |
| 5 | Progressive reveal interface | UI + Animation | ✅ |
| 6 | Simplified filter system | Component + Performance | ✅ |
| 7 | Enhanced sort dropdown | Component + UX | ✅ |
| 8 | Sticky tab navigation | UI + Responsive | ✅ |
| 9 | Attached expanded views | Animation + UX | ✅ |
| 10-13 | TDD Requirements | Comprehensive | ✅ |

---

### **🧪 Test Architecture Recommendations**

#### **1. Unit Testing Strategy**
- **Framework:** Vitest + React Testing Library (existing infrastructure)
- **Location:** `src/__tests__/components/search/`
- **Coverage Target:** 80% line, 85% function, 70% branch
- **Pattern:** Given-When-Then scenarios for all search functionality

#### **2. Integration Testing Strategy**
- **Search Service Integration:** Test `AttendeeService.searchAttendees()` extensions
- **PWA Integration:** Test offline search with `OfflineAttendeeService`
- **Sponsor Integration:** Test `SponsorService` connections
- **Cache Integration:** Test localStorage-first search result caching

#### **3. Performance Testing Strategy**
- **Large Dataset Testing:** 1000+ attendee records (existing pattern)
- **Search Optimization:** Debounced search with 300ms delay
- **Virtual Scrolling:** Lists > 100 items
- **Memory Management:** 5-minute cleanup testing
- **Performance Thresholds:** < 100ms for search operations

#### **4. PWA Testing Strategy**
- **Offline Search:** Test cached attendee data availability
- **Service Worker Integration:** Test search result caching
- **Background Sync:** Test search data synchronization
- **Network State:** Test online/offline transitions

#### **5. Security & Privacy Testing**
- **RLS Compliance:** Test attendee privacy settings respect
- **Data Filtering:** Test public information only exposure
- **Access Control:** Test authentication integration
- **Audit Trail:** Test search activity logging

---

### **🔍 Risk Assessment**

#### **HIGH RISK AREAS**
1. **Performance with Large Datasets** - 235+ attendees with complex filtering
2. **PWA Offline Functionality** - Search must work without network
3. **Privacy Compliance** - Discoverability opt-out settings critical
4. **Animation Performance** - Progressive reveal and sticky navigation

#### **MEDIUM RISK AREAS**
1. **Sponsor Integration** - Complex data relationships
2. **Search Result Caching** - Memory management and cleanup
3. **Responsive Design** - Sticky navigation across screen sizes

#### **LOW RISK AREAS**
1. **Basic Search Functionality** - Well-established patterns
2. **Component Architecture** - Following existing patterns
3. **State Management** - Using proven hook patterns

---

### **📊 Test Coverage Requirements**

#### **Component Testing**
- **AttendeeSearchSection:** Progressive reveal, filtering, sorting
- **SearchControls:** Debounced input, filter toggles, sort dropdown
- **AttendeeProfile:** Display, navigation, contact information
- **StickyNavigation:** Positioning, z-index, transitions

#### **Service Testing**
- **SearchService:** Enhanced filtering, pagination, caching
- **OfflineSearchService:** PWA integration, cache management
- **SponsorSearchService:** Sponsor attendee discovery
- **PerformanceService:** Large dataset handling, memory management

#### **Integration Testing**
- **Authentication Integration:** User identification and access control
- **PWA Integration:** Offline functionality and background sync
- **Sponsor Integration:** Sponsor attendee filtering and display
- **Cache Integration:** localStorage-first search result management

---

### **🚀 Enhanced Test Strategy Recommendations**

#### **1. Performance Testing Enhancements**
```typescript
// Example: Large Dataset Performance Test
describe('Search Performance', () => {
  it('should handle 1000+ attendees efficiently', async () => {
    const largeDataset = generateAttendeeData(1000);
    const startTime = performance.now();
    
    const results = await searchService.searchAttendees('test', largeDataset);
    
    expect(performance.now() - startTime).toBeLessThan(100);
    expect(results).toHaveLength(expect.any(Number));
  });
});
```

#### **2. PWA Testing Enhancements**
```typescript
// Example: Offline Search Test
describe('PWA Offline Search', () => {
  it('should search cached attendees when offline', async () => {
    // Mock offline state
    mockNavigatorOnLine(false);
    
    const results = await offlineSearchService.searchAttendees('test');
    
    expect(results.success).toBe(true);
    expect(results.data).toBeDefined();
  });
});
```

#### **3. Privacy Testing Enhancements**
```typescript
// Example: Privacy Compliance Test
describe('Privacy Compliance', () => {
  it('should respect discoverability opt-out settings', () => {
    const attendeeWithOptOut = { ...mockAttendee, discoverability: false };
    
    const results = searchService.filterByPrivacy([attendeeWithOptOut]);
    
    expect(results).toHaveLength(0);
  });
});
```

---

### **📈 Quality Metrics**

| Metric | Target | Current | Status |
|---|---|---|---|
| Unit Test Coverage | 80% line | TBD | 🟡 |
| Integration Test Coverage | 70% branch | TBD | 🟡 |
| Performance Threshold | < 100ms | TBD | 🟡 |
| PWA Offline Coverage | 100% | TBD | 🟡 |
| Security Test Coverage | 100% | TBD | 🟡 |

---

### **✅ Quality Gate Decision: PASS**

**Rationale:** Story has comprehensive test strategy with clear requirements traceability, appropriate risk assessment, and enhanced testing recommendations. All acceptance criteria are testable with existing infrastructure patterns.

**Next Steps:**
1. Implement test infrastructure following recommended patterns
2. Execute performance testing with large datasets
3. Validate PWA offline functionality
4. Complete security and privacy testing
5. Achieve target coverage metrics

**Confidence Level:** High - Well-defined test strategy with proven patterns
