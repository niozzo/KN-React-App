# Story 2.1: Now/Next Glance Card

## Status
Draft

## Story
**As an** attendee,  
**I want** to see my next session with countdown, room, and topic on the home screen,  
**so that** I can quickly know what's happening now and what's next.

## Acceptance Criteria
1. Shows next upcoming item based on current time and personal assignments
2. Displays countdown (minutes remaining), room, topic; updates on focus
3. Works offline using cached data; revalidates on network
4. Tapping opens full session detail with quick "Find my seat" if applicable
5. Handles edge cases: between sessions, last session of day, no assignments
6. Shows current session if active (Now card) + next session (Next card)
7. Countdown updates every minute; real-time updates on app focus
8. Integration with admin broadcast countdown timers
9. **Smart Countdown Logic**: Meals (breakfast, lunch, dinner, coffee breaks) only show countdown when in "Now" status; all other sessions show time range in top-right corner
10. **Consistent Time Placement**: Time information always appears in top-right corner of both Now and Next cards
11. **Countdown as Status Text**: When meals are in "Now" status, countdown replaces the "Now" text in the status badge
12. **Prominent Now Card Styling**: Light purple background, top border, and shadow to distinguish current session
13. **Simplified Navigation**: Single "View Full Schedule" CTA replaces redundant quick action cards
14. **Date and Time Override**: Users can set a custom date/time that the system uses as the "current" time, with real-time progression from that override point (DEV/STAGING ONLY - NOT AVAILABLE IN PRODUCTION)

## Tasks / Subtasks
- [ ] Task 1: Create Now/Next card components (AC: 1, 6)
  - [ ] Design Now card for current session
  - [ ] Design Next card for upcoming session
  - [ ] Implement responsive card layout
  - [ ] Add card animations and transitions
- [ ] Task 2: Implement countdown functionality (AC: 2, 7)
  - [ ] Create countdown timer component
  - [ ] Implement minute-by-minute updates
  - [ ] Add real-time updates on app focus
  - [ ] Handle countdown edge cases
- [ ] Task 3: Add offline support (AC: 3)
  - [ ] Implement data caching strategy
  - [ ] Add offline data retrieval
  - [ ] Implement network revalidation
  - [ ] Add offline indicators
- [ ] Task 4: Add seat assignment integration (AC: 4)
  - [ ] Implement card tap navigation to schedule
  - [ ] Add "Find my seat" quick action
  - [ ] Implement seat assignment display
- [ ] Task 5: Handle edge cases (AC: 5)
  - [ ] Implement between-sessions state
  - [ ] Handle last session of day
  - [ ] Handle no assignments scenario
  - [ ] Add appropriate messaging for each state
- [ ] Task 6: Integrate with admin broadcasts (AC: 8)
  - [ ] Connect to broadcast countdown timers
  - [ ] Implement broadcast message display
  - [ ] Add broadcast countdown integration
  - [ ] Handle broadcast priority
- [ ] Task 7: Implement smart countdown logic (AC: 9)
  - [ ] Create session type detection (meal vs. non-meal)
  - [ ] Implement countdown display logic for meals in "Now" status
  - [ ] Implement time range display for all other sessions
  - [ ] Add visual indicators for different session types
- [ ] Task 8: Implement date and time override feature (AC: 14) - DEV/STAGING ONLY
  - [ ] Create time override context/provider for global time state
  - [ ] Add date/time picker UI component for setting override (environment-gated)
  - [ ] Implement override time storage (localStorage/sessionStorage)
  - [ ] Create real-time progression from override time (second-by-second)
  - [ ] Update all time-dependent components to use override time
  - [ ] Add override time indicator/status display (environment-gated)
  - [ ] Implement override time reset/clear functionality
  - [ ] Add validation for override time (within conference dates)
  - [ ] Add environment detection to disable feature in production
  - [ ] Test time progression accuracy and performance
  - [ ] Verify feature is completely hidden/disabled in production builds

## Dev Notes
### Project Context
The Now/Next glance card is the primary value proposition of the Conference Companion PWA. It provides C-level executives with instant access to their current and next sessions with minimal taps.

### Technical Requirements
- **Framework**: React with TypeScript
- **State Management**: Context API or Redux
- **Real-time Updates**: WebSocket or polling
- **Offline Support**: Service worker caching
- **Performance**: < 1.0s update time on app focus
- **Environment Gating**: Time override feature must be completely disabled in production builds

### Data Requirements
- Current time and session data
- User assignments and preferences
- Session details (title, room, time, topic)
- Seat assignments when applicable
- Admin broadcast messages
- Override time settings (date, time, timezone)
- Conference date range for validation

### UI/UX Requirements
- **Design**: Clean, professional, glanceable
- **Responsive**: Mobile-first design
- **Accessibility**: WCAG 2.1 AA compliance
- **Performance**: Smooth animations and transitions
- **Offline**: Clear offline indicators

### UX Design Notes
- **Visual Hierarchy**: Now card uses light purple background, top border, and shadow for prominence
- **Information Architecture**: Time consistently placed in top-right corner for predictable scanning
- **Smart Countdowns**: Only meals/breaks in "Now" status show countdown; others show time range
- **Reduced Cognitive Load**: Single schedule CTA instead of multiple quick action cards
- **Consistent Styling**: No left borders on any cards; clean, minimal design approach
- **Status Integration**: Countdown replaces "Now" text when applicable for cleaner layout
- **Layout Consistency**: Must match schedule page layout exactly - status (left) and time (right) in same line
- **Seat Visibility**: White background for seat info in current session cards for better contrast
- **Content Positioning**: Title, location, speaker details in consistent positions across both pages
- **Time Override UI**: Clean, accessible date/time picker with clear visual indication when override is active
- **Override Status**: Subtle but clear indicator showing when time override is enabled
- **Time Progression**: Smooth, accurate second-by-second progression from override time

### Environment Gating Implementation
- **Environment Detection**: Use `process.env.NODE_ENV` or custom environment variables
- **Build-time Gating**: Use webpack/Vite environment variables to completely remove code in production
- **Runtime Gating**: Double-check environment at runtime before rendering override UI
- **Code Splitting**: Ensure override-related code is not included in production bundle
- **Testing**: Verify feature is completely absent in production builds

### Testing Standards
- **Test Framework**: Jest + React Testing Library
- **Test Location**: `src/__tests__/components/`
- **Coverage**: All card states and interactions
- **Performance Testing**: Update timing and responsiveness
- **Offline Testing**: Network failure scenarios
- **Environment Testing**: Verify feature is disabled in production builds

### Key Considerations
- Countdown accuracy and performance
- Offline data availability
- Real-time update efficiency
- User experience during edge cases
- Integration with other app features
- Time override accuracy and performance
- Override time validation and edge cases
- User experience when switching between real time and override
- Impact on all time-dependent features across the app
- **Environment Gating**: Ensure time override feature is completely removed from production builds
- **Security**: Prevent any possibility of time override in production environment
- **Build Process**: Verify environment gating works correctly in CI/CD pipeline

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | Initial story creation | Sarah (PO) |
| 2024-12-19 | 1.1 | Added smart countdown logic, consistent time placement, and UX design notes | Sally (UX Expert) |
| 2024-12-19 | 1.2 | Added layout consistency requirements and seat visibility improvements | Sarah (PO) |
| 2024-12-19 | 1.3 | Added date and time override feature (Task 8) with acceptance criteria and UX considerations | Sarah (PO) |
| 2024-12-19 | 1.4 | Added environment gating requirements - time override feature is DEV/STAGING ONLY, not available in production | Sarah (PO) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*
