# Story 2.2.4: Remove Confidential Attendee Information from Local Cache

**Story ID:** 2.2.4  
**Epic:** Data Privacy & Security  
**Priority:** High  
**Story Points:** 8  
**Status:** Ready for Development  

## User Story

As a **conference attendee**, I want **confidential personal information to be filtered out of the local cache** so that **sensitive data is not exposed if someone browses my device's local storage**.

## Acceptance Criteria

### Primary Confidential Fields to Remove
The following fields must be completely removed from the `kn_cache_attendees` local cache:

1. **Contact Information:**
   - `business_phone` - Business phone number
   - `mobile_phone` - Mobile phone number

2. **Travel & Accommodation:**
   - `check_in_date` - Hotel check-in date
   - `check_out_date` - Hotel check-out date
   - `hotel_selection` - Selected hotel
   - `custom_hotel` - Custom hotel name

3. **Personal Details:**
   - `has_spouse` - Whether attendee has spouse
   - `dietary_requirements` - Dietary restrictions/preferences
   - `is_spouse` - Whether this is a spouse record
   - `spouse_details` - Complete spouse information object (email, name, phone, dietary requirements)

4. **Address Information:**
   - `address1` - Primary address line
   - `address2` - Secondary address line
   - `postal_code` - ZIP/postal code
   - `city` - City
   - `state` - State/province
   - `country` - Country name
   - `country_code` - Country code

5. **Assistant Information:**
   - `assistant_name` - Assistant's name
   - `assistant_email` - Assistant's email

6. **System Identifiers:**
   - `idloom_id` - External system ID

### Additional Fields for Review
The following fields should be reviewed for potential confidentiality concerns:

1. **Registration Data:**
   - `registration_id` - May contain sensitive registration information
   - `access_code` - Authentication code (already filtered in AttendeeInfoService)

2. **Event Preferences:**
   - `dining_selections` - May contain personal dietary preferences
   - `selected_breakouts` - Personal session selections

## Technical Requirements

### 1. Cache Filtering Implementation
- **Location:** `src/services/attendeeCacheService.ts` (new service)
- **Method:** Create `filterConfidentialFields()` function
- **Approach:** Whitelist approach - only include safe fields in cache

### 2. Safe Fields to Include
```typescript
interface SafeAttendeeCache {
  id: string;
  first_name: string;
  last_name: string;
  email: string;
  title: string;
  company: string;
  bio: string;
  photo: string;
  salutation: string;
  registration_status: string;
  registration_id: string; // Keep for functionality
  dining_selections: DiningSelections; // Keep for event functionality
  selected_breakouts: string[]; // Keep for event functionality
  attributes: {
    ceo: boolean;
    apaxIP: boolean;
    speaker: boolean;
    cLevelExec: boolean;
    sponsorAttendee: boolean;
    otherAttendeeType: boolean;
    portfolioCompanyExecutive: boolean;
  };
  is_cfo: boolean;
  is_apax_ep: boolean;
  primary_attendee_id: string | null;
  company_name_standardized: string;
  last_synced_at: string;
  created_at: string;
  updated_at: string;
}
```

### 3. Integration Points
- **AttendeeTransformer:** Update to use filtered data
- **UnifiedCacheService:** Apply filtering before cache storage
- **AttendeeInfoService:** Ensure no confidential data leaks through

### 4. Testing Requirements
- **Unit Tests:** Verify filtering removes all confidential fields
- **Integration Tests:** Ensure app functionality works with filtered data
- **Security Tests:** Verify no confidential data in localStorage
- **Regression Tests:** Ensure existing features still work

## Implementation Plan

### Phase 1: Create Filtering Service
1. Create `AttendeeCacheFilterService`
2. Implement field filtering logic
3. Add comprehensive unit tests

### Phase 2: Integrate with Cache System
1. Update `UnifiedCacheService` to use filtering
2. Modify `AttendeeTransformer` to work with filtered data
3. Update `AttendeeInfoService` if needed

### Phase 3: Testing & Validation
1. Run full test suite
2. Verify no confidential data in localStorage
3. Test all attendee-related functionality
4. Performance testing with filtered data

## Definition of Done

- [ ] All confidential fields removed from local cache
- [ ] Filtering service created and tested
- [ ] Integration with existing cache system
- [ ] All tests passing
- [ ] No confidential data visible in browser localStorage
- [ ] App functionality preserved
- [ ] Performance impact assessed and acceptable
- [ ] Security review completed

## Risk Assessment

### High Risk
- **Breaking Changes:** Removing fields might break existing features
- **Performance Impact:** Filtering may slow down cache operations
- **Data Loss:** Accidentally removing fields needed for functionality

### Mitigation Strategies
- **Comprehensive Testing:** Full regression test suite
- **Gradual Rollout:** Feature flag for filtering
- **Monitoring:** Cache performance metrics
- **Rollback Plan:** Ability to disable filtering if issues arise

## Dependencies

- **Story 2.1f1:** Unified Cache Service (completed)
- **Story 1.7:** Data Transformation Layer (completed)
- **Story 1.2:** Database Integration (completed)

## Notes

- This story addresses GDPR/privacy compliance concerns
- Consider implementing data retention policies for cached data
- May need to update privacy policy documentation
- Consider adding audit logging for data access

## Related Stories

- **Story 2.1f1:** Unified Cache Service
- **Story 1.7:** Data Transformation Layer
- **Future:** Data Retention Policy Implementation
