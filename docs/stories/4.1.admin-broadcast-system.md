# Story 4.1: Admin Broadcast System

## Status
Draft

## Story
**As an** admin,  
**I want** to send broadcast messages to attendees,  
**so that** I can communicate important updates and timing changes.

## Acceptance Criteria
1. Broadcast composer with title, message, optional link, optional countdown timer
2. Countdown timer allows setting specific minutes (5, 10, 15, 30, 60) for break reminders
3. Target audience: all attendees (cohorting for later)
4. Web Push to installed users; in-app banners fallback
5. Delivery logging and impression measurement
6. Respects user notification consent settings
7. Countdown broadcasts show live countdown in app until event occurs
8. **TDD**: All broadcast system components have comprehensive unit tests (80% line coverage)
9. **TDD**: Integration tests for broadcast creation, delivery, and user interactions (70% branch coverage)
10. **TDD**: PWA testing for web push notifications and offline fallback
11. **TDD**: Real-time testing for countdown timers and live updates

## Tasks / Subtasks
- [ ] Task 1: Create broadcast composer (AC: 1, 2)
  - [ ] Design broadcast creation interface
  - [ ] Implement title and message fields
  - [ ] Add optional link functionality
  - [ ] Implement countdown timer selection
- [ ] Task 2: Implement audience targeting (AC: 3)
  - [ ] Create audience selection interface
  - [ ] Implement "all attendees" targeting
  - [ ] Add cohorting framework for future
  - [ ] Add audience preview functionality
- [ ] Task 3: Add push notification system (AC: 4)
  - [ ] Implement Web Push notifications
  - [ ] Create in-app banner fallback
  - [ ] Add notification delivery logic
  - [ ] Handle notification failures
- [ ] Task 4: Implement delivery tracking (AC: 5)
  - [ ] Create delivery logging system
  - [ ] Add impression measurement
  - [ ] Implement analytics tracking
  - [ ] Add delivery status reporting
- [ ] Task 5: Add consent management (AC: 6)
  - [ ] Implement consent checking
  - [ ] Add consent respect logic
  - [ ] Create consent reporting
  - [ ] Handle consent changes
- [ ] Task 6: Create countdown display (AC: 7)
  - [ ] Implement live countdown in app
  - [ ] Add countdown timer display
  - [ ] Create countdown completion handling
  - [ ] Add countdown persistence
- [ ] Task 7: Implement TDD for broadcast system (AC: 8-11)
  - [ ] Write unit tests for broadcast composer, delivery, and countdown components (80% line coverage)
  - [ ] Write integration tests for broadcast creation and user interactions (70% branch coverage)
  - [ ] Write PWA tests for web push notifications and offline fallback scenarios
  - [ ] Write real-time tests for countdown timers and live updates
  - [ ] Validate test coverage meets all thresholds
  - [ ] Update test documentation with Given-When-Then patterns

## Dev Notes
### Project Context
The admin broadcast system enables conference organizers to communicate important updates, timing changes, and break reminders to all attendees in real-time.

### Technical Requirements
- **Push Notifications**: Web Push API
- **Real-time**: Live countdown timers
- **Analytics**: Delivery and impression tracking
- **Privacy**: Consent management integration

### Testing Standards
- **Test Framework**: Vitest + React Testing Library (TDD infrastructure established)
- **Test Location**: `src/__tests__/components/admin/broadcast/`
- **Coverage**: 80% line, 85% function, 70% branch coverage
- **PWA Testing**: Web push notifications and offline fallback scenarios
- **Real-time Testing**: Countdown timers and live updates validation
- **Integration Testing**: Broadcast creation, delivery, and user interactions
- **Test Pattern**: Given-When-Then for all broadcast system scenarios

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*Results from QA Agent review will be populated here*
