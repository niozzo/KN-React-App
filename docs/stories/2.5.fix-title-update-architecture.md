# Story 2.5: Fix Title Update Architecture - Single Source of Truth

## User Story

As a **conference administrator**,
I want **title updates to be immediately reflected in all parts of the application**,
So that **users see consistent, up-to-date information without data inconsistencies**.

## Story Context

**Existing System Integration:**
- Integrates with: Admin interface, API endpoints, card display components
- Technology: Supabase, React, TypeScript, Node.js API
- Follows pattern: Direct database updates instead of metadata table approach
- Touch points: `adminService.ts`, `/api/agenda-items.js`, `/api/dining-options.js`, card components

## Acceptance Criteria

**Functional Requirements:**

1. **Agenda Item Title Updates**: When admin updates an agenda item title, the change is immediately reflected in the main `agenda_items` table
2. **Dining Option Title Updates**: When admin updates a dining option title, the change is immediately reflected in the main `dining_options` table
3. **Immediate API Response**: API endpoints return updated titles without requiring cache invalidation or client-side merging

**Integration Requirements:**

4. **API Consistency**: Both `/api/agenda-items.js` and `/api/dining-options.js` return updated titles immediately
5. **Card Display**: Now/Next cards and all other components display updated titles without refresh
6. **Admin Interface**: Admin interface continues to work with the same update flow

**Quality Requirements:**

7. **Data Consistency**: Single source of truth eliminates metadata table complexity
8. **Performance**: No joins required for title display, improving API performance
9. **Maintainability**: Simplified architecture reduces code complexity

## Technical Notes

- **Integration Approach**: Update main database tables directly instead of using separate metadata tables
- **Existing Pattern Reference**: Follow standard CRUD operations pattern for database updates
- **Key Constraints**: Must maintain backward compatibility with existing admin interface

## Definition of Done

- [ ] `adminService.updateAgendaItemTitle()` updates `agenda_items` table directly
- [ ] `adminService.updateDiningOptionTitle()` updates `dining_options` table directly
- [ ] API endpoints return updated titles immediately without joins
- [ ] Card components display updated titles without client-side merging
- [ ] All existing functionality continues to work unchanged
- [ ] Metadata tables can be deprecated (future cleanup)
- [ ] Tests pass for both agenda and dining title updates
- [ ] No regression in existing functionality verified

## Technical Implementation

**Database Changes:**
- Update `agenda_items.title` directly instead of `agenda_item_metadata.title`
- Update `dining_options.name` directly instead of `dining_item_metadata.name`

**Code Changes:**
- Modify `adminService.updateAgendaItemTitle()` to update main table
- Modify `adminService.updateDiningOptionTitle()` to update main table
- Remove metadata table queries from API endpoints
- Remove client-side title merging logic

**Benefits:**
- Single source of truth
- Immediate consistency
- Simplified architecture
- Better performance
- Easier maintenance

## Risk Assessment

**Primary Risk:** Breaking existing admin interface functionality
**Mitigation:** Maintain same method signatures, only change implementation
**Rollback:** Revert to metadata table approach if issues arise

**Compatibility Verification:**
- [ ] No breaking changes to existing APIs
- [ ] Database changes are direct updates (no schema changes)
- [ ] UI changes follow existing patterns
- [ ] Performance impact is positive (no joins required)

## Status

**Ready for Development**

## Dev Agent Record

**Agent Model Used:** TBD
**Debug Log References:** TBD
**Completion Notes:** TBD
**File List:** TBD
**Change Log:** TBD
