# Story 8.5: Debug Speaker Assignment Sync Issue

## **Problem Statement**

Speaker assignments are not syncing properly from the application database to the local cache, causing speakers to not display for specific events despite being assigned in the admin interface.

## **Current Workaround**

The issue is currently resolved by manually overriding the speaker assignment in the application database, but this is not a sustainable solution.

## **Root Cause Analysis**

### **Issue Description**
- Speaker assignments are successfully created via the admin interface
- Assignments are saved to the application database
- However, the `pwaDataSyncService` is not properly syncing these assignments to the local cache
- This results in speakers not appearing on the frontend for specific events

### **Affected Components**
1. **Admin Interface** - Speaker assignment creation works correctly
2. **Application Database** - Assignments are stored successfully
3. **PWA Data Sync Service** - Sync process is not retrieving assignments
4. **Frontend Display** - Speakers don't appear due to missing cache data

### **Technical Details**

#### **Data Flow**
```
Admin Interface → Application Database → PWA Sync Service → Local Cache → Frontend Display
```

#### **Debugging Attempts**
- Added comprehensive debug logging to trace data flow
- Created manual sync triggers for testing
- Exposed services globally for console debugging
- Identified that sync process is not being triggered during normal operation

#### **Key Files Modified**
- `src/services/pwaDataSyncService.ts` - Added debug logging and manual sync trigger
- `src/services/adminService.ts` - Added debug logging for assignment creation
- `src/services/applicationDatabaseService.ts` - Added debug logging for database operations
- `src/services/agendaService.ts` - Added debug logging for speaker enrichment
- `src/hooks/useSessionData.js` - Added debug logging for session data loading
- `src/components/session/SessionCard.jsx` - Added debug logging for speaker display

## **Acceptance Criteria**

### **Must Have**
- [ ] Speaker assignments sync automatically from application database to local cache
- [ ] Speakers display correctly for all events without manual intervention
- [ ] Sync process is triggered during normal application operation
- [ ] Debug logging is removed from production code

### **Should Have**
- [ ] Comprehensive error handling for sync failures
- [ ] Monitoring and alerting for sync issues
- [ ] Performance optimization for sync operations

### **Could Have**
- [ ] Real-time sync notifications
- [ ] Sync status dashboard
- [ ] Automated sync health checks

## **Technical Requirements**

### **Investigation Areas**
1. **Sync Trigger Mechanism** - Why isn't the sync process being triggered?
2. **Database Query Issues** - Are assignments being retrieved from the database?
3. **Data Validation** - Are assignments being filtered out during validation?
4. **Cache Update Process** - Are assignments being properly cached?
5. **Frontend Data Loading** - Are cached assignments being loaded correctly?

### **Debug Tools Created**
- Manual sync trigger: `window.pwaDataSyncService.debugSyncSpeakerAssignments()`
- Database direct query: `window.serviceRegistry.getApplicationDbClient()`
- Cache inspection: `window.pwaDataSyncService.getCachedTableData('speaker_assignments')`

## **Implementation Notes**

### **Current Status**
- Issue is temporarily resolved with manual database override
- Debug logging is in place for investigation
- Services are exposed globally for console debugging
- Manual sync trigger is available for testing

### **Next Steps**
1. **Investigate sync trigger mechanism** - Determine why sync isn't being called
2. **Test database queries** - Verify assignments are being retrieved
3. **Check data validation** - Ensure assignments aren't being filtered out
4. **Verify cache updates** - Confirm assignments are being cached properly
5. **Test frontend loading** - Ensure cached data is being used correctly

### **Cleanup Required**
- Remove debug logging from production code
- Remove global service exposure
- Remove manual sync triggers
- Clean up temporary debug files

## **Dependencies**

### **Related Stories**
- Story 1.2: Database Integration & Data Access Layer Setup
- Story 1.3: PWA Polish & Branding
- Story 2.6.1: Implement Server-Side Attendee Data Filtering

### **Technical Dependencies**
- PWA Data Sync Service
- Application Database Service
- Admin Service
- Agenda Service
- Frontend Components

## **Testing Strategy**

### **Manual Testing**
1. Create speaker assignment via admin interface
2. Verify assignment is saved to database
3. Check if assignment appears in local cache
4. Verify speaker displays on frontend
5. Test sync process manually

### **Automated Testing**
- Unit tests for sync service
- Integration tests for data flow
- End-to-end tests for speaker display

## **Risk Assessment**

### **High Risk**
- Speaker assignments not syncing could affect user experience
- Manual overrides are not sustainable
- Debug logging in production could impact performance

### **Medium Risk**
- Sync failures could cause data inconsistency
- Performance impact from debug logging
- Global service exposure could create security concerns

### **Low Risk**
- Temporary workaround is functional
- Issue is isolated to specific events
- No data loss or corruption

## **Success Metrics**

- [ ] 100% of speaker assignments sync automatically
- [ ] Zero manual interventions required
- [ ] Sync process completes within 5 seconds
- [ ] No performance impact from debug code
- [ ] All debug logging removed from production

## **Story Points**
**8 points** - Complex investigation and debugging required

## **Priority**
**Medium** - Issue is resolved with workaround, but needs proper fix for production

## **Assignee**
TBD - Requires investigation and debugging expertise

## **Sprint**
TBD - Can be addressed when time permits

---

**Created**: 2024-12-19  
**Status**: Open  
**Last Updated**: 2024-12-19

